<div class="quick-invoice-container">
  <mat-card class="invoice-card">
    <mat-card-header>
      <mat-card-title>Quick Invoice Calculator</mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <div class="customer-section">
        <div class="customer-input-wrapper">
          <input type="text" class="customer-input" [(ngModel)]="customerName" 
                 placeholder="Customer Name" x-webkit-speech speech #customerNameInput>
          <button mat-icon-button class="mic-button" (click)="startVoiceRecognition()" 
                  [class.listening]="isListening">
            <mat-icon>{{ isListening ? 'mic' : 'mic_none' }}</mat-icon>
          </button>
        </div>
      </div>
      
      <div class="action-buttons">
        <button mat-raised-button color="primary" (click)="addProduct()">
          <mat-icon>add</mat-icon> Add Product
        </button>
        <button mat-raised-button color="accent" (click)="downloadPDF()" [disabled]="!isValidForPrint()">
          <mat-icon>download</mat-icon> Download PDF
        </button>
        <button mat-raised-button color="accent" (click)="printInvoice()" [disabled]="!isValidForPrint()">
          <mat-icon>print</mat-icon> Print
        </button>
      </div>

      <div class="table-container" *ngIf="items.length > 0">
        <table class="invoice-table">
          <thead>
            <tr>
              <th>Sl.No</th>
              <th>Product Name</th>
              <th>Quantity</th>
              <th>Rate</th>
              <th>Total</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of items; let i = index">
              <td>{{ i + 1 }}</td>
              <td>
                <div class="input-with-mic">
                  <input type="text" class="native-input" [(ngModel)]="item.product" 
                         placeholder="Product" x-webkit-speech speech #productInput>
                  <button mat-icon-button class="inline-mic-button" (click)="startProductVoiceRecognition(i)" 
                          [class.listening]="listeningIndex === i">
                    <mat-icon>{{ listeningIndex === i ? 'mic' : 'mic_none' }}</mat-icon>
                  </button>
                </div>
              </td>
              <td>
                <input type="number" class="native-input" [(ngModel)]="item.quantity" 
                       (ngModelChange)="calculateTotal(item)" min="1" placeholder="Qty">
              </td>
              <td>
                <input type="number" class="native-input" [(ngModel)]="item.rate" 
                       (ngModelChange)="calculateTotal(item)" min="0" step="0.01" placeholder="Rate">
              </td>
              <td class="total-cell">₹{{ item.total | number:'1.2-2' }}</td>
              <td>
                <button mat-icon-button color="warn" (click)="deleteItem(i)">
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="grand-total">
          <strong>Grand Total: ₹{{ getGrandTotal() | number:'1.2-2' }}</strong>
        </div>
      </div>

      <div class="empty-state" *ngIf="items.length === 0">
        <mat-icon>receipt_long</mat-icon>
        <p>No items added yet. Click "Add Product" to start.</p>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Hidden print area -->
  <div id="invoice-print-area" style="display: none;">
    <h1>Quick Invoice</h1>
    <p><strong>Date:</strong> {{ today | date:'dd/MM/yyyy' }}</p>
    <p><strong>Customer:</strong> {{ customerName || 'N/A' }}</p>
    <table>
      <thead>
        <tr>
          <th>Sl.No</th>
          <th>Product Name</th>
          <th>Quantity</th>
          <th>Rate</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of items; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ item.product }}</td>
          <td>{{ item.quantity }}</td>
          <td>₹{{ item.rate | number:'1.2-2' }}</td>
          <td>₹{{ item.total | number:'1.2-2' }}</td>
        </tr>
        <tr class="total-row">
          <td colspan="4" style="text-align: right;"><strong>Grand Total:</strong></td>
          <td><strong>₹{{ getGrandTotal() | number:'1.2-2' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
